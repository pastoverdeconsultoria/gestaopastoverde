</div>
</div>
</div>}

{modal==='piquete'&&<div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4">
<div className="bg-white rounded-lg shadow-2xl max-w-md w-full p-4">
<div className="flex justify-between items-center mb-4">
<h2 className="text-lg font-bold">Editar Ãrea</h2>
<button onClick={()=>{setModal(null);setFd({});setFe([]);setEd(null)}} className="text-gray-500"><X size={20}/></button>
</div>
{fe.length>0&&<div className="mb-3 p-2 bg-red-50 border border-red-200 rounded">{fe.map((e,i)=><div key={i} className="text-red-800 text-xs">â€¢ {e}</div>)}</div>}
<div className="space-y-3">
<div>
<label className="block text-xs font-semibold mb-1">Nome *</label>
<input type="text" value={fd.nome||''} onChange={e=>setFd({...fd,nome:e.target.value})} className="w-full px-3 py-2 border rounded text-sm"/>
</div>
<div>
<label className="flex items-center gap-2 cursor-pointer">
<input type="checkbox" checked={fd.ehReserva||false} onChange={e=>setFd({...fd,ehReserva:e.target.checked})} className="w-4 h-4"/>
<span className="text-sm">ğŸŒ³ Marcar como Reserva/PreservaÃ§Ã£o</span>
</label>
</div>
<div className="flex gap-2 pt-2">
<button onClick={edPiq} className="flex-1 bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700 font-semibold text-sm">Salvar</button>
<button onClick={()=>{setModal(null);setFd({});setFe([]);setEd(null)}} className="px-4 py-2 bg-gray-200 rounded hover:bg-gray-300 text-sm">Cancelar</button>
</div>
</div>
</div>
</div>}

{modal==='modulo'&&<div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4">
<div className="bg-white rounded-lg shadow-2xl max-w-md w-full p-4 max-h-[90vh] overflow-y-auto">
<div className="flex justify-between items-center mb-4">
<h2 className="text-lg font-bold">{ed?'Editar':'Novo'} MÃ³dulo</h2>
<button onClick={()=>{setModal(null);setFd({});setFe([]);setEd(null)}} className="text-gray-500"><X size={20}/></button>
</div>
{fe.length>0&&<div className="mb-3 p-2 bg-red-50 border border-red-200 rounded">{fe.map((e,i)=><div key={i} className="text-red-800 text-xs">â€¢ {e}</div>)}</div>}
<div className="space-y-3">
<div>
<label className="block text-xs font-semibold mb-1">Nome *</label>
<input type="text" value={fd.nome||''} onChange={e=>setFd({...fd,nome:e.target.value})} className="w-full px-3 py-2 border rounded text-sm"/>
</div>
<div>
<label className="block text-xs font-semibold mb-1">Ãreas (mÃ­n 2) *</label>
<div className="border rounded p-3 max-h-48 overflow-y-auto space-y-1">
{piqF.filter(p=>(!p.moduloId||p.moduloId===ed?.id)&&!p.ehReserva).map(p=><label key={p.id} className="flex items-center gap-2 p-1 hover:bg-gray-50 rounded cursor-pointer">
<input type="checkbox" checked={(fd.piquetesSelecionados||[]).includes(p.id)} onChange={e=>{const c=fd.piquetesSelecionados||[],u=e.target.checked?[...c,p.id]:c.filter(id=>id!==p.id);setFd({...fd,piquetesSelecionados:u})}} className="w-4 h-4"/>
<div className="text-sm">
<div className="font-semibold">{p.nome}</div>
<div className="text-xs text-gray-600">{p.area}ha</div>
</div>
</label>)}
</div>
</div>
<div className="flex gap-2 pt-2">
<button onClick={ed?edMod:crMod} className="flex-1 bg-green-600 text-white px-4 py-2 rounded hover:bg-green-700 font-semibold text-sm">{ed?'Salvar':'Criar'}</button>
<button onClick={()=>{setModal(null);setFd({});setFe([]);setEd(null)}} className="px-4 py-2 bg-gray-200 rounded hover:bg-gray-300 text-sm">Cancelar</button>
</div>
</div>
</div>
</div>}

{modal==='lote'&&<div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4">
<div className="bg-white rounded-lg shadow-2xl max-w-md w-full p-4 max-h-[90vh] overflow-y-auto">
<div className="flex justify-between items-center mb-4">
<h2 className="text-lg font-bold">{ed?'Editar':'Novo'} Grupo</h2>
<button onClick={()=>{setModal(null);setFd({});setFe([]);setEd(null)}} className="text-gray-500"><X size={20}/></button>
</div>
{fe.length>0&&<div className="mb-3 p-2 bg-red-50 border border-red-200 rounded">{fe.map((e,i)=><div key={i} className="text-red-800 text-xs">â€¢ {e}</div>)}</div>}
<div className="space-y-3">
<div>
<label className="block text-xs font-semibold mb-1">Nome *</label>
<input type="text" value={fd.nome||''} onChange={e=>setFd({...fd,nome:e.target.value})} className="w-full px-3 py-2 border rounded text-sm"/>
</div>
<div>
<label className="block text-xs font-semibold mb-1">Categoria *</label>
<select value={fd.categoria||''} onChange={e=>setFd({...fd,categoria:e.target.value})} className="w-full px-3 py-2 border rounded text-sm">
<option value="">Selecione...</option>
{cat.map(c=><option key={c} value={c}>{c}</option>)}
</select>
</div>
<div className="grid grid-cols-2 gap-2">
<div>
<label className="block text-xs font-semibold mb-1">Peso(kg)*</label>
<input type="number" step="0.01" value={fd.pesoMedio||''} onChange={e=>setFd({...fd,pesoMedio:e.target.value})} className="w-full px-3 py-2 border rounded text-sm"/>
</div>
<div>
<label className="block text-xs font-semibold mb-1">Qtd *</label>
<input type="number" value={fd.quantidade||''} onChange={e=>setFd({...fd,quantidade:e.target.value})} className="w-full px-3 py-2 border rounded text-sm"/>
</div>
</div>
{fd.pesoMedio&&fd.quantidade&&<div className="bg-blue-50 border border-blue-200 rounded p-2">
<div className="font-semibold text-blue-800 text-xs">Total UA: {calcUA(parseFloat(fd.pesoMedio),parseInt(fd.quantidade))}</div>
</div>}
{!ed&&<div>
<label className="block text-xs font-semibold mb-1">Ãrea Inicial (opcional)</label>
<select value={fd.piqueteInicial||''} onChange={e=>setFd({...fd,piqueteInicial:e.target.value})} className="w-full px-3 py-2 border rounded text-sm">
<option value="">Nenhuma (alocar depois)</option>
{piqF.filter(p=>!p.loteAtualId&&!p.ehReserva).map(p=><option key={p.id} value={p.id}>{p.nome} ({p.area}ha)</option>)}
</select>
</div>}
<div className="flex gap-2 pt-2">
<button onClick={ed?edLot:crLot} className="flex-1 bg-green-600 text-white px-4 py-2 rounded hover:bg-green-700 font-semibold text-sm">{ed?'Salvar':'Criar'}</button>
<button onClick={()=>{setModal(null);setFd({});setFe([]);setEd(null)}} className="px-4 py-2 bg-gray-200 rounded hover:bg-gray-300 text-sm">Cancelar</button>
</div>
</div>
</div>
</div>}

{modal==='alocar'&&sel&&<div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4">
<div className="bg-white rounded-lg shadow-2xl max-w-sm w-full p-4 max-h-[90vh] overflow-y-auto">
<div className="flex justify-between items-center mb-3">
<h2 className="text-lg font-bold">Alocar Grupo</h2>
<button onClick={()=>setModal(null)} className="text-gray-500"><X size={20}/></button>
</div>
<div className="mb-3">
<div className="text-xs text-gray-600 mb-1">Ãrea:</div>
<div className="font-semibold">{sel.nome} ({sel.area}ha)</div>
</div>
<div className="space-y-2">
<div className="text-xs font-semibold text-gray-700">Selecione o grupo:</div>
{(()=>{const ll=lotF.filter(l=>l.status==='livre');if(ll.length===0)return <p className="text-xs text-gray-500 bg-yellow-50 border border-yellow-200 rounded p-3">âš ï¸ Nenhum grupo livre</p>;return ll.map((l,idx)=>{const lr=(l.totalUA/parseFloat(sel.area)).toFixed(2);const cor=getLoteCor(lotF.findIndex(x=>x.id===l.id));return <button key={l.id} onClick={()=>aloc(sel.id,l.id)} className="w-full text-left border-2 border-gray-200 rounded p-3 hover:border-green-500 hover:bg-green-50 transition">
<div className="flex items-center gap-2 font-semibold mb-1">
<span style={{color:cor}} className="text-xl">â—</span>
<span>ğŸ® {l.nome}</span>
</div>
<div className="text-xs text-gray-600 mt-1">{l.categoria} Â· {l.quantidade}cab Â· {l.totalUA}UA</div>
<div className="mt-1 bg-blue-50 text-blue-800 text-xs font-semibold px-2 py-1 rounded inline-block">LotaÃ§Ã£o: {lr} UA/ha</div>
</button>})})()}
</div>
</div>
</div>}

{modal==='transferir'&&sel&&<div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4">
<div className="bg-white rounded-lg shadow-2xl max-w-sm w-full p-4 max-h-[90vh] overflow-y-auto">
<div className="flex justify-between items-center mb-3">
<h2 className="text-lg font-bold">Transferir Grupo</h2>
<button onClick={()=>setModal(null)} className="text-gray-500"><X size={20}/></button>
</div>
{(()=>{const l=lot.find(x=>x.id===sel.loteAtualId);if(!l)return null;const cor=getLoteCor(lotF.findIndex(x=>x.id===l.id));return <>
<div className="mb-3">
<div className="text-xs text-gray-600 mb-1">Origem:</div>
<div className="font-semibold">{sel.nome} ({sel.area}ha)</div>
<div className="flex items-center gap-2 text-sm mt-1">
<span style={{color:cor}} className="text-lg">â—</span>
<span>ğŸ® {l.nome}</span>
</div>
</div>
<div className="space-y-2">
<div className="text-xs font-semibold text-gray-700">Destino:</div>
{piqF.filter(p=>!p.loteAtualId&&p.id!==sel.id&&!p.ehReserva).map(p=>{const lr=(l.totalUA/parseFloat(p.area)).toFixed(2);return <button key={p.id} onClick={()=>transf(sel.id,p.id)} className="w-full text-left border-2 border-gray-200 rounded p-3 hover:border-blue-500 hover:bg-blue-50 transition">
<div className="font-semibold">{p.nome}</div>
<div className="text-xs text-gray-600 mt-1">{p.area}ha Â· Vazio</div>
<div className="mt-1 bg-blue-50 text-blue-800 text-xs font-semibold px-2 py-1 rounded inline-block">LotaÃ§Ã£o: {lr} UA/ha</div>
</button>})}
</div>
</>})()}
</div>
</div>}
</div>}

ReactDOM.createRoot(document.getElementById('root')).render(<App/>);
</script>
</body>
</html>
